/* --------------------------------------------
   FIT GUARD (append-only, shrink-only overrides)
   Scope: contest, ascension, score pages.
   Never change assets, fonts, ribbons, or order.
---------------------------------------------*/

@layer fitguard {

  /* Page must never scroll */
  .contest-wrap,
  .ascension-wrap,
  .score-wrap {
    height: 100svh;          /* modern viewport unit */
    max-height: 100svh;
    overflow: hidden;
  }

  /* Reserve test banner if present */
  .contest-wrap[data-has-test-banner],
  .ascension-wrap[data-has-test-banner],
  .score-wrap[data-has-test-banner] {
    padding-top: 42px;       /* banner height */
    box-sizing: border-box;
  }

  /* ---------- SCORE PAGE ONLY ---------- */
  .score-wrap {
    /* keep top-third caption; will shrink at small heights below */
    --captionH: 32svh;
    display: grid;
    grid-template-rows: var(--captionH) 1fr;
  }

  /* Never let buttons grid explode; two tidy rows */
  .score-wrap .buttons-grid {
    grid-auto-flow: column;
    gap: clamp(8px, 1.4vw, 16px);
    padding: clamp(8px, 2.4vw, 22px);
  }

  .score-wrap .btn-card {
    /* shrink-only caps */
    min-height: clamp(54px, 6.5svh, 72px);
    font-size: clamp(12px, 1.35vw, 18px);
  }

  .score-wrap .btn-card small {
    font-size: clamp(11px, 1.15vw, 14px);
  }

  /* Caption text shrink-only; keep typeface/shadow intact */
  .score-wrap .caption-stage p {
    font-size: clamp(15px, 3.0vw, 44px);
    line-height: 1.08;
  }

  /* Keep ship visible; soften mist but do not change asset */
  .score-wrap .ship-area::after {
    background: rgba(255,255,255, calc(var(--mist, .55)));
    box-shadow: inset 0 0 140px rgba(255,255,255,.60);
  }

  /* Pill stack sized safely on phones; no overlap with ribbons */
  .score-wrap .pill-stack,
  .score-wrap .pill-stack-abs {
    width: min(240px, 34vw);
  }

  @media (max-width: 480px) {
    .score-wrap .pill-stack,
    .score-wrap .pill-stack-abs {
      width: min(200px, 38vw);
    }
  }

  /* ---------- ASCENSION PAGE ONLY ---------- */
  .ascension-wrap {
    display: grid;
    place-items: center;
  }

  .ascension-wrap .doors {
    gap: clamp(12px, 3.5vw, 40px);
  }

  .ascension-wrap .red-door {
    width: min(30vw, 360px);
    aspect-ratio: 2 / 3;
  }

  .ascension-wrap .door-label {
    font-size: clamp(18px, 2.4vw, 36px);
  }

  /* ---------- CONTEST PAGE ONLY ---------- */
  .contest-wrap .cta-row {
    gap: clamp(8px, 2vw, 20px);
  }

  .contest-wrap .cta-row .cta-button {
    min-height: clamp(48px, 6svh, 64px);
    font-size: clamp(14px, 1.5vw, 18px);
  }

  /* Very short laptops (≤720px tall) */
  @media (max-height: 720px) {
    .score-wrap {
      --captionH: 26svh;
    }
    .score-wrap .btn-card {
      min-height: 52px;
      font-size: clamp(12px, 1.2vw, 15px);
    }
  }

  /* Tiny phones (≤360px wide) */
  @media (max-width: 360px) {
    .score-wrap .btn-card {
      min-height: 50px;
      font-size: clamp(12px, 3.2vw, 14px);
    }
    .score-wrap .pill-stack,
    .score-wrap .pill-stack-abs {
      width: min(180px, 44vw);
    }
  }

}

/* =========================================================
   FIT GUARD v2 — stronger clamps (append-only)
   Targets: sample-chapters, enter-contest, score & contest.
   Never upsizes; only shrinks. No asset/font swaps.
   Prevents vertical & horizontal scroll.
=========================================================*/

@layer fitguard {

  /* Never allow horizontal scroll on these pages */
  .contest-wrap,
  .ascension-wrap,
  .score-wrap,
  .sample-wrap,
  .enter-wrap {
    overflow-x: hidden;
    max-width: 100%;
  }

  /* ---------- SCORE (stronger clamps) ---------- */
  /* Keep two tidy rows & reduce overall density a touch */
  .score-wrap { --captionH: 30svh; }
  @media (max-height: 820px){ .score-wrap { --captionH: 28svh; } }
  @media (max-height: 740px){ .score-wrap { --captionH: 26svh; } }

  .score-wrap .buttons-grid{
    gap: clamp(6px, 1.0vw, 12px);
    padding: clamp(6px, 1.8vw, 16px);
    grid-auto-flow: column; /* stay on 2 rows */
  }
  .score-wrap .btn-card{
    min-height: clamp(48px, 5.8svh, 60px);
    font-size: clamp(12px, 1.1vw, 15px);
  }
  .score-wrap .btn-card small{
    font-size: clamp(11px, 1.0vw, 13px);
  }
  /* Pill stack a bit slimmer so it never crowds ribbons */
  .score-wrap .pill-stack,
  .score-wrap .pill-stack-abs{ width: min(200px, 30vw); }
  @media (max-width: 480px){
    .score-wrap .pill-stack,
    .score-wrap .pill-stack-abs{ width: min(180px, 44vw); }
  }
  /* Right-side ribbons scale down on short screens */
  @media (max-height: 820px){
    .rank-ribbon, .rabbit-ribbon{ transform: scale(.92); transform-origin: top right; }
  }
  @media (max-height: 740px){
    .rank-ribbon, .rabbit-ribbon{ transform: scale(.86); }
  }

  /* ---------- CONTEST (Ticker / info banners / CTAs) ---------- */
  .contest-wrap .ticker,
  .contest-wrap .info-banner{
    font-size: clamp(12px, 1.3vw, 16px);
    padding: clamp(6px, 1.2vw, 12px);
  }
  .contest-wrap .cta-row{
    gap: clamp(8px, 1.6vw, 16px);
  }
  .contest-wrap .cta-row .cta-button{
    min-height: clamp(46px, 5.5svh, 60px);
    font-size: clamp(13px, 1.2vw, 16px);
  }

  /* ---------- SAMPLE CHAPTERS ---------- */
  .sample-wrap .hero,
  .sample-wrap .video,
  .sample-wrap .stage{
    max-height: 46svh; /* keep the top area from consuming the page */
  }
  .sample-wrap .caption,
  .sample-wrap h1,
  .sample-wrap h2{
    font-size: clamp(16px, 2.4vw, 28px);
    line-height: 1.15;
  }
  .sample-wrap .cta-row{
    gap: clamp(8px, 1.6vw, 16px);
    padding: clamp(8px, 2vw, 16px);
  }
  .sample-wrap .cta{
    min-height: clamp(44px, 5.2svh, 58px);
    font-size: clamp(13px, 1.2vw, 16px);
  }

  /* ---------- ENTER CONTEST FORM ---------- */
  .enter-wrap form{
    gap: clamp(8px, 1.6vw, 18px);
    padding: clamp(10px, 2vw, 18px);
  }
  .enter-wrap input,
  .enter-wrap select,
  .enter-wrap textarea{
    font-size: clamp(13px, 2.6vw, 16px);
    padding: clamp(8px, 1.8vw, 12px);
  }
  .enter-wrap button[type="submit"]{
    min-height: clamp(44px, 5.2svh, 56px);
    font-size: clamp(13px, 1.2vw, 16px);
    padding: clamp(8px, 1.8vw, 12px) clamp(12px, 2.4vw, 16px);
  }

  /* Small height laptops – one more gentle squeeze */
  @media (max-height: 720px){
    .contest-wrap .cta-row .cta-button,
    .sample-wrap .cta,
    .enter-wrap button[type="submit"],
    .score-wrap .btn-card { font-size: clamp(12px,1.0vw,14px); }
    .score-wrap .btn-card { min-height: 50px; }
  }

}

/* ==============================================
   FIT GUARD v3 (append-only, shrink-only)
   Targets: contest, score, sample, enter
   Goal: no vertical/horizontal scroll; everything fits.
============================================== */
@layer fitguard {
  /* Safety: never allow horizontal scroll on scoped pages */
  .contest-wrap, .score-wrap, .sample-wrap, .enter-wrap, .ascension-wrap {
    overflow-x: hidden;
    max-width: 100%;
  }

  /* ---- Global typography clamps within wrappers ---- */
  .contest-wrap :where(h1,h2,h3),
  .score-wrap   :where(h1,h2,h3),
  .sample-wrap  :where(h1,h2,h3),
  .enter-wrap   :where(h1,h2,h3) {
    /* shrink big headings down on small/short screens */
    font-size: clamp(18px, 3.0vw, 42px);
    line-height: 1.08;
  }

  /* Standard action/button scales */
  .contest-wrap :where(button,.btn,.cta-button,.btn-card),
  .score-wrap   :where(button,.btn,.cta-button,.btn-card),
  .sample-wrap  :where(button,.btn,.cta),
  .enter-wrap   :where(button,.btn,.cta) {
    min-height: clamp(44px, 5.2svh, 60px);
    font-size: clamp(12px, 1.15vw, 16px);
  }
  .contest-wrap :where(small,.subtext),
  .score-wrap   :where(small,.subtext) {
    font-size: clamp(11px, 1.0vw, 13px);
  }

  /* ---- Score page density ---- */
  .score-wrap { --captionH: 26svh; }
  @media (max-height: 820px){ .score-wrap { --captionH: 24svh; } }
  @media (max-height: 740px){ .score-wrap { --captionH: 22svh; } }

  .score-wrap .buttons-grid {
    gap: clamp(6px, 1.0vw, 12px);
    padding: clamp(6px, 1.6vw, 14px);
    grid-template-rows: repeat(2, 1fr);
  }
  .score-wrap .btn-card {
    min-height: clamp(46px, 5.4svh, 58px);
    font-size: clamp(12px, 1.05vw, 15px);
  }
  .score-wrap .pill-stack, .score-wrap .pill-stack-abs { width: min(190px, 28vw); }
  @media (max-width: 480px){
    .score-wrap .pill-stack, .score-wrap .pill-stack-abs { width: min(170px, 44vw); }
  }
  /* ribbons scale subtly on short heights */
  @media (max-height: 820px){ .rank-ribbon, .rabbit-ribbon { transform: scale(.9); transform-origin: top right; } }
  @media (max-height: 740px){ .rank-ribbon, .rabbit-ribbon { transform: scale(.84); } }

  /* ---- Contest page (ticker/info/CTA) ---- */
  .contest-wrap .ticker, .contest-wrap .info-banner {
    font-size: clamp(12px, 1.25vw, 16px);
    padding: clamp(6px, 1.2vw, 10px);
  }
  .contest-wrap .cta-row { gap: clamp(8px, 1.4vw, 14px); }

  /* ---- Sample chapters ---- */
  .sample-wrap .hero, .sample-wrap .video, .sample-wrap .stage {
    max-height: 42svh;
  }
  .sample-wrap :where(.caption, h1, h2) {
    font-size: clamp(16px, 2.2vw, 28px);
  }
  .sample-wrap .cta-row { gap: clamp(8px, 1.4vw, 14px); }
  .sample-wrap .cta     { min-height: clamp(44px, 5svh, 56px); }

  /* ---- Enter contest form ---- */
  .enter-wrap form { gap: clamp(8px, 1.4vw, 16px); padding: clamp(8px, 1.8vw, 14px); }
  .enter-wrap :where(input,select,textarea) {
    font-size: clamp(13px, 2.2vw, 16px);
    padding: clamp(8px, 1.6vw, 12px);
  }
  .enter-wrap button[type="submit"] {
    min-height: clamp(44px, 5svh, 56px);
    font-size: clamp(13px, 1.1vw, 16px);
  }

  /* Last-mile squeeze for very short displays */
  @media (max-height: 700px){
    .score-wrap .btn-card      { min-height: 44px; font-size: clamp(12px, 1.0vw, 14px); }
    .contest-wrap .cta-button  { min-height: 44px; font-size: clamp(12px, 1.0vw, 14px); }
    .sample-wrap .cta          { min-height: 42px; font-size: clamp(12px, 1.0vw, 14px); }
  }
}
@layer fitguard;

